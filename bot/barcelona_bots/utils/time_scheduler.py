import asyncio
import re
from datetime import datetime, timedelta
from config.bots import user_bot as bot
from aiogram.types import InlineKeyboardButton, InlineKeyboardMarkup, WebAppInfo  # pyright: ignore[reportMissingImports]
from sqlalchemy import select  # pyright: ignore[reportMissingImports]
from sqlalchemy.ext.asyncio import AsyncSession  # pyright: ignore[reportMissingImports]

from config.logger import logger
from database.database import connection
from database.models import SendTime, Clients

from materials.materials import text_10, text_24
from materials import materials as m

from apscheduler.schedulers.asyncio import AsyncIOScheduler  # pyright: ignore[reportMissingImports]

# –≠–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è MarkdownV2: —ç–∫—Ä–∞–Ω–∏—Ä—É–µ–º —Å–ª—É–∂–µ–±–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã, –ù–û —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ *–∂–∏—Ä–Ω–æ–≥–æ* –∏ _–∫—É—Ä—Å–∏–≤–∞_
# –ü–æ—ç—Ç–æ–º—É –∏–∑ –Ω–∞–±–æ—Ä–∞ –∏—Å–∫–ª—é—á–∞–µ–º '*' –∏ '_'
_MDV2_SPECIALS = r"[\[\]()~`>#+\-=|{}.!]"  # –±–µ–∑ \\
_mdv2_pattern = re.compile(fr"(?<!\\)({_MDV2_SPECIALS})")

def escape_md_v2(text: str) -> str:
    # –í—Å—Ç–∞–≤–ª—è–µ—Ç –†–û–í–ù–û –æ–¥–∏–Ω –æ–±—Ä–∞—Ç–Ω—ã–π —Å–ª–µ—à –ø–µ—Ä–µ–¥ —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª–æ–º
    return _mdv2_pattern.sub(r"\\\1", text)

# –î–ª—è –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–æ–∫ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö (–∏–º–µ–Ω–∞, —é–∑–µ—Ä–Ω–µ–π–º—ã) —ç–∫—Ä–∞–Ω–∏—Ä—É–µ–º –ñ–ï–°–¢–ß–ï: –≤–∫–ª—é—á–∞—è '*' –∏ '_'
_MDV2_STRICT = r"[_*\[\]()~`>#+\-=|{}.!]"
_mdv2_strict_pattern = re.compile(fr"(?<!\\)({_MDV2_STRICT})")

def escape_md_v2_strict(text: str) -> str:
    return _mdv2_strict_pattern.sub(r"\\\1", text)

# –ù–∞–¥–æ –≤ main –ø–æ–¥–∫–ª—é—á–∞—Ç—å
async def on_startup():
    # –ó–∞–ø—É—Å–∫–∞–µ–º –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ —Ä–∞—Å—Å—ã–ª–æ–∫
    await setup_scheduler()

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞–ø–æ–º–∏–Ω–∞–ª–∫–∏
async def setup_scheduler():
    scheduler = AsyncIOScheduler()

    async def job():
        # –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ –æ—Ç–ø—Ä–∞–≤–∫—É
        await check_and_send_materials()  # pyright: ignore[reportCallIssue]

    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –±–¥ –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É –µ—Å—Ç—å –ª–∏ –∫–æ–º—É –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª—ã
    scheduler.add_job(
        job,
        'interval',
        minutes=1,
        next_run_time=datetime.now()  # –ó–∞–ø—É—Å—Ç–∏—Ç—Å—è —Å—Ä–∞–∑—É
    )
    scheduler.start()

@connection
async def check_and_send_materials(session: AsyncSession):
    """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∑–∞–ø–∏—Å–∏ –≤ SendTime –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –¥–æ–º–∞—à–∫–∏"""
    try:
        # –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è (—Å –∑–∞–ø–∞—Å–æ–º –≤ 1 –º–∏–Ω—É—Ç—É)
        now = datetime.now()


        # –ò—â–µ–º –∑–∞–ø–∏—Å–∏, —É –∫–æ—Ç–æ—Ä—ã—Ö –≤—Ä–µ–º—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–∂–µ –ø—Ä–æ—à–ª–æ (<= —Ç–µ–∫—É—â–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏)
        stmt = select(SendTime).where(
            SendTime.time_to_send <= now
        ).order_by(
            SendTime.time_to_send.asc(),
            SendTime.material_id.asc(),
            SendTime.send_id.asc()
        )  # –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –≤—Ä–µ–º–µ–Ω–∏, –∑–∞—Ç–µ–º —Å—Ç–∞–±–∏–ª—å–Ω–æ –ø–æ –º–∞—Ç–µ—Ä–∏–∞–ª—É –∏ id

        # –ò—â–µ–º –∑–∞–ø–∏—Å–∏, —É –∫–æ—Ç–æ—Ä—ã—Ö –≤—Ä–µ–º—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–∞—Å—Ç—É–ø–∏–ª–æ
        # time_threshold = now + timedelta(minutes=1)
        # stmt = select(SendTime).where(
        #     SendTime.time_to_send >= now,
        #     SendTime.time_to_send <= time_threshold
        # )

        result = await session.execute(stmt)
        records_to_send = result.scalars().all()

        if not records_to_send:
            return  # –ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏

        # keyboard = InlineKeyboardMarkup(  # pyright: ignore[reportUndefinedVariable]
        #     inline_keyboard=[
        #         [
        #             InlineKeyboardButton(text="–ö–£–ü–ò–¢–¨ - 1.500—Ä—É–± (15‚Ç¨)", url="https://t.me/tribute/app?startapp=stA6")  # pyright: ignore[reportUndefinedVariable]
        #         ]
        #     ]
        # )

        # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –º–∞—Ç–µ—Ä–∏–∞–ª—ã –¥–ª—è –∫–∞–∂–¥–æ–π –Ω–∞–π–¥–µ–Ω–Ω–æ–π –∑–∞–ø–∏—Å–∏
        for record in records_to_send:
            if record.material_id == 1:
                webapp1_keyboard = InlineKeyboardMarkup(
                    inline_keyboard=[
                        [
                            InlineKeyboardButton(
                                text="–ó–ê–ë–†–ê–¢–¨ –§–ê–ô–õ ‚úÖ",
                                web_app=WebAppInfo(url="https://illariooo.ru")
                            )
                        ]
                    ]
                )
                try:
                    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
                    await bot.send_message(chat_id=record.user_id, text = escape_md_v2(r"""*–ü—Ä–æ—Å—Ç–æ —Å–∫–æ–ø–∏—Ä—É–π –º–æ—é —Å–∏—Å—Ç–µ–º—É* üí∞

–í–Ω—É—Ç—Ä–∏ —Ñ–∞–π–ª–∞ —Ä–∞—Å—Å–∫–∞–∑–∞–ª –ø—Ä–æ –Ω–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É –∑–∞—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞ AI\-–ú–æ–¥–µ–ª—è—Ö:

\- –ë–µ–∑ –∫–æ–º–∞–Ω–¥—ã
\- –ë–µ–∑ —Ä–µ–∫–ª–∞–º—ã
\- –ë–µ–∑ –æ–≥—Ä–æ–º–Ω—ã—Ö –∑–∞—Ç—Ä–∞—Ç –≤—Ä–µ–º–µ–Ω–∏

C–∫–æ–ø–∏—Ä—É–π –º–æ—é —Å–∏—Å—Ç–µ–º—É –∏ –ø–æ–ª—É—á–∏ —Å–≤–æ–π –ø–µ—Ä–≤—ã–π –¥–æ—Ö–æ–¥ \- –æ—Ç 1000 $ 

*–£–∂–µ –≤ –ø–µ—Ä–≤—ã–π –º–µ—Å—è—Ü*

–í—Å—è –∏–Ω—Ñ–∞ –ø–æ –∫–Ω–æ–ø–∫–µ –Ω–∏–∂–µ üëá
"""), 
                    parse_mode="MarkdownV2", reply_markup=webapp1_keyboard)  # pyright: ignore[reportUndefinedVariable]

                    logger.info(f"–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ –ø–æ–∫—É–ø–∫–µ AI-Model 2.0 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é {record.user_id}.")

                    # –£–¥–∞–ª—è–µ–º –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—É—é –∑–∞–ø–∏—Å—å (–∏–ª–∏ –ø–æ–º–µ—á–∞–µ–º –∫–∞–∫ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—É—é)
                    await session.delete(record)

                except Exception as e:
                    logger.error(f"–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ for –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è 10 –¥–ª—è user_id={record.user_id}: {e}")
                    # –£–¥–∞–ª—è–µ–º –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—É—é –∑–∞–ø–∏—Å—å (–∏–ª–∏ –ø–æ–º–µ—á–∞–µ–º –∫–∞–∫ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—É—é)
                    await session.delete(record)
                    continue
            elif record.material_id == 2:
                try:
                    webapp2_keyboard = InlineKeyboardMarkup(
                        inline_keyboard=[
                            [
                                InlineKeyboardButton(
                                    text="–ó–∞–±—Ä–∞—Ç—å –≥–∞–π–¥ üî•",
                                    web_app=WebAppInfo(url="https://illariooo.ru")
                                )
                            ]
                        ]
                    )
                    photo2_url = "AgACAgIAAxkBAANdaQjLyc_xt7MMPnTrUPiLAAFEAYPyAAKWEGsbtApASKobiRPXrearAQADAgADeQADNgQ"
                    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
                    await bot.send_photo(chat_id=record.user_id, photo=photo2_url, caption=escape_md_v2(r"""*–ö–æ–≥–¥–∞ –æ–¥–Ω–∞ —Å–ª—É—á–∞–π–Ω–∞—è –Ω–æ—á—å –∏–∑–º–µ–Ω–∏–ª–∞ –≤—Å–µ‚Ä¶*

–ü–æ–º–Ω—é, –∫–∞–∫ —Å–∏–¥–µ–ª –∑–∞ –Ω–æ—É—Ç–æ–º –æ—á–µ—Ä–µ–¥–Ω–æ–π –Ω–æ—á—å—é.

–Ø —Å–Ω–æ–≤–∞ –ª–∏—Å—Ç–∞–ª —é—Ç—É–±, –≤ –Ω–∞–¥–µ–∂–¥–µ –Ω–∞–π—Ç–∏ —Ö–æ—Ç—å —á—Ç–æ-—Ç–æ, —á—Ç–æ —Ä–µ–∞–ª—å–Ω–æ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç.

–ö—Ä–∏–ø—Ç–∞, –∞—Ä–±–∏—Ç—Ä–∞–∂, —à–æ–ø–∏—Ñ–∞–π, –Ω—Ñ—Ç \- —É–∂–µ –ø—Ä–æ—à–µ–ª —á–µ—Ä–µ–∑ —ç—Ç–æ‚Ä¶

–ö–∞–∂–¥—ã–π —Ä–∞–∑ –æ–¥–Ω–æ –∏ —Ç–æ –∂–µ:
–î–µ–Ω—å–≥–∏ –≤ –Ω–∏—à–∞—Ö –µ—Å—Ç—å \- –Ω–æ —Ç—Ä–∞—Ç–∞ –≤—Ä–µ–º–µ–Ω–∏ –ø—Ä–∏–≤–æ–¥–∏–ª–∞ –∫ –≤—ã–≥–æ—Ä–∞–Ω–∏—é.

–ò —Ç–æ–≥–¥–∞ —è –Ω–∞—Ç–∫–Ω—É–ª—Å—è –Ω–∞ –≤–∏–¥–µ–æ:

*AI\-–º–æ–¥–µ–ª–∏ ‚Äî –Ω–æ–≤–∞—è –ø—Ä–æ—Ñ–µ—Å—Å–∏—è 2025 –≥–æ–¥–∞*

–Ø –Ω–∞–∂–∞–ª –ø—Ä–æ—Å—Ç–æ –ø–æ –ø—Ä–∏–∫–æ–ª—É.
–ê —á–µ—Ä–µ–∑ –º–µ—Å—è—Ü —É–∂–µ –∑–∞—Ä–∞–±–æ—Ç–∞–ª –ø–µ—Ä–≤—ã–µ $1000 —Å —Ü–∏—Ñ—Ä–æ–≤–æ–π –º–æ–¥–µ–ª—å—é,
–∫–æ—Ç–æ—Ä—É—é —Å–æ–∑–¥–∞–ª —Å –Ω—É–ª—è –∑–∞ 30 –º–∏–Ω—É—Ç üòÖ

–ë–µ–∑ –∫–æ–º–∞–Ω–¥—ã. –ë–µ–∑ –≤–ª–æ–∂–µ–Ω–∏–π. –ë–µ–∑ –ª–∏—Ü–∞.

–° —Ç–µ—Ö –ø–æ—Ä \- –∂–∏–∑–Ω—å –∏–∑–º–µ–Ω–∏–ª–∞—Å—å.
–í–º–µ—Å—Ç–æ —Ç–∞–±–ª–∏—Ü –∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ —è —Å–æ–∑–¥–∞—é –º–æ–¥–µ–ª–µ–π, –∫–æ—Ç–æ—Ä—ã–µ –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç –¥–∞–∂–µ —Ç–æ–≥–¥–∞, –∫–æ–≥–¥–∞ —è —Å–ø–ª—é.
–≠—Ç–æ –Ω–µ –æ—á–µ—Ä–µ–¥–Ω–∞—è —Ç–µ–º–∫–∞.
–≠—Ç–æ –ø—Ä–æ—Ñ–µ—Å—Å–∏—è, –∫–æ—Ç–æ—Ä–∞—è –æ—â—É—â–∞–µ—Ç—Å—è –∫–∞–∫ –∏—Å–∫—É—Å—Å—Ç–≤–æ.

üëá –ó–∞–±–∏—Ä–∞–π –º–æ–π –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π —Ñ–∞–π–ª, –≥–¥–µ —è –ø–æ–¥—Ä–æ–±–Ω–æ —Ä–∞—Å—Å–∫–∞–∑–∞–ª, –∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –º–æ—è —Å–∏—Å—Ç–µ–º–∞ AI Model 2.0

–ò –∫–∞–∫ –≤—ã–π—Ç–∏ –Ω–∞ –ø–µ—Ä–≤—ã–µ üí≤ —É–∂–µ –≤ –ø–µ—Ä–≤—ã–π –º–µ—Å—è—Ü
"""), parse_mode="MarkdownV2", reply_markup=webapp2_keyboard)  # pyright: ignore[reportUndefinedVariable]

                    logger.info(f"–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ –ø–æ–∫—É–ø–∫–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é {record.user_id}.")

                    # –£–¥–∞–ª—è–µ–º –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—É—é –∑–∞–ø–∏—Å—å (–∏–ª–∏ –ø–æ–º–µ—á–∞–µ–º –∫–∞–∫ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—É—é)
                    await session.delete(record)

                except Exception as e:
                    logger.error(f"–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è 24 –¥–ª—è user_id={record.user_id}: {e}")
                    # –£–¥–∞–ª—è–µ–º –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—É—é –∑–∞–ø–∏—Å—å (–∏–ª–∏ –ø–æ–º–µ—á–∞–µ–º –∫–∞–∫ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—É—é)
                    await session.delete(record)
                    continue
            elif record.material_id == 3:
                try:
                    webapp3_keyboard = InlineKeyboardMarkup(
                        inline_keyboard=[
                            [
                                InlineKeyboardButton(
                                    text="–ó–∞–±—Ä–∞—Ç—å –ø–æ–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ ‚è∞",
                                    web_app=WebAppInfo(url="https://illariooo.ru")
                                )
                            ]
                        ]
                    )
                    photo3_url = "AgACAgIAAxkBAAMaaQhqO7NWfaTyoVoLymZ0qs4JRPYAAkYNaxu0CkBIBFKRsaEptjEBAAMCAAN4AAM2BA"
                    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
                    await bot.send_photo(chat_id=record.user_id, photo=photo3_url, caption=escape_md_v2(r"""üé≠ *–ö–æ–≥–¥–∞ —Ç—ã –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞–µ—à—å, –∞ —Ç—ã –¥–∞–∂–µ –Ω–µ –ø–æ—è–≤–ª—è–µ—à—å—Å—è –Ω–∞ –ø—É–±–ª–∏–∫–µ‚Ä¶*

–°–∞–º—ã–π —á–∞—Å—Ç—ã–π –≤–æ–ø—Ä–æ—Å, –∫–æ—Ç–æ—Ä—ã–π –º–Ω–µ –∑–∞–¥–∞—é—Ç:

\- –ò–ª—é—Ö, –∞ –∫–∞–∫ –º–æ–∂–Ω–æ –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –Ω–∞ AI\-–º–æ–¥–µ–ª—è—Ö, –µ—Å–ª–∏ —É —Ç–µ–±—è –Ω–µ—Ç –Ω–∏ –∫–æ–º–∞–Ω–¥—ã, –Ω–∏ —Ä–µ–∫–ª–∞–º—ã‚Ä¶ –∏ —è –Ω–µ —Ö–æ—á—É —Å–Ω–∏–º–∞—Ç—å —Å–µ–±—è?

–ò –≤–æ—Ç –≤ —ç—Ç–æ–º - –≤—Å—è –∫—Ä–∞—Å–æ—Ç–∞ –º–æ–µ–π —Å–∏—Å—Ç–µ–º—ã ü§ù

AI\-–º–æ–¥–µ–ª—å \- —ç—Ç–æ –ª–∏—á–Ω–æ—Å—Ç—å, –∫–æ—Ç–æ—Ä—É—é —Ç—ã —Å–æ–∑–¥–∞–µ—à—å —Å–∞–º.
–û–Ω–∞ –≤—ã–≥–ª—è–¥–∏—Ç –∫–∞–∫ —Ä–µ–∞–ª—å–Ω—ã–π —á–µ–ª–æ–≤–µ–∫, —Å –ª–∏—Ü–æ–º, —Å—Ç–∏–ª–µ–º, –≤–∞–π–±–æ–º -
–Ω–æ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç —Ç–æ–ª—å–∫–æ —Ç–µ–±–µ‚Ä¶

‚Ä¶ –ò —á–µ–ª–æ–≤–µ–∫ –Ω–µ –º–æ–∂–µ—Ç –ø–æ–Ω—è—Ç—å, —á—Ç–æ –æ–Ω–∞ –Ω–µ—Ä–µ–∞–ª—å–Ω–∞—è üòâ

–¢—ã –º–æ–∂–µ—à—å —É–ø—Ä–∞–≤–ª—è—Ç—å –µ—é, –∫–∞–∫ —Ö—É–¥–æ–∂–Ω–∏–∫:
–ø—Ä–∏–¥—É–º—ã–≤–∞—Ç—å –≤–∏–∑—É–∞–ª—ã, —Ç–µ–∫—Å—Ç–∞, —ç–º–æ—Ü–∏–∏,
*–∞ —Å–∏—Å—Ç–µ–º–∞ —Å–∞–º–∞ –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç —ç—Ç–æ –≤ –¥–æ—Ö–æ–¥.*

–ö–æ–≥–¥–∞ —è –≤–ø–µ—Ä–≤—ã–µ –ø–æ–Ω—è–ª, —á—Ç–æ –º–æ–∂–Ω–æ –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –±–µ–∑ —Å–≤–æ–µ–≥–æ –ª–∏—Ü–∞,
—è –æ—â—É—Ç–∏–ª –Ω–µ –ø—Ä–æ—Å—Ç–æ –¥–µ–Ω—å–≥–∏ - *–∞ —Å–≤–æ–±–æ–¥—É.*
–°–≤–æ–±–æ–¥—É –±—ã—Ç—å –∑–∞ –∫–∞–¥—Ä–æ–º,
–Ω–æ –ø—Ä–∏ —ç—Ç–æ–º —Å—Ç—Ä–æ–∏—Ç—å —Ä–µ–∞–ª—å–Ω—ã–π –æ–Ω–ª–∞–π–Ω-–±–∏–∑–Ω–µ—Å,

–í –∫–æ—Ç–æ—Ä–æ–º –Ω–µ—Ç –∫–æ–Ω–∫—É—Ä–µ–Ω—Ü–∏–∏ \(–ø–æ–∫–∞ —á—Ç–æ\)

–ò–º–µ–Ω–Ω–æ –ø–æ—ç—Ç–æ–º—É —è –∏ —Å–æ–∑–¥–∞–ª –∫–æ—Ä–æ—Ç–∫–∏–π –≥–∞–π–¥ -
–≤ –Ω–µ–º –ø–æ–¥—Ä–æ–±–Ω–æ –ø–æ–∫–∞–∑–∞–ª, –∫–∞–∫ –≤—Å–µ —É—Å—Ç—Ä–æ–µ–Ω–æ –∏–∑–Ω—É—Ç—Ä–∏, 
–∫–∞–∫ —Ç—ã –º–æ–∂–µ—à—å –∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–≤–æ—é –ø–µ—Ä–≤—É—é AI-–º–æ–¥–µ–ª—å —É–∂–µ —á–µ—Ä–µ–∑ 30 –º–∏–Ω—É—Ç.

–ó–∞–±–∏—Ä–∞–π —Ñ–∞–π–ª –∏ —É–±–µ–¥–∏—Å—å —Å–∞–º, —á—Ç–æ –±—É–¥—É—â–µ–µ –æ–Ω–ª–∞–π–Ω-–±–∏–∑–Ω–µ—Å–∞ —É–∂–µ –Ω–∞—Å—Ç—É–ø–∏–ª–æ üëá
"""), parse_mode="MarkdownV2", reply_markup=webapp3_keyboard)  # pyright: ignore[reportUndefinedVariable]

                    logger.info(f"–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ –ø–æ–∫—É–ø–∫–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é {record.user_id}.")

                    # –£–¥–∞–ª—è–µ–º –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—É—é –∑–∞–ø–∏—Å—å (–∏–ª–∏ –ø–æ–º–µ—á–∞–µ–º –∫–∞–∫ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—É—é)
                    await session.delete(record)

                except Exception as e:
                    logger.error(f"–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è 3 –¥–ª—è user_id={record.user_id}: {e}")
                    # –£–¥–∞–ª—è–µ–º –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—É—é –∑–∞–ø–∏—Å—å (–∏–ª–∏ –ø–æ–º–µ—á–∞–µ–º –∫–∞–∫ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—É—é)
                    await session.delete(record)
                    continue
            elif record.material_id == 4:
                try:
                    photo4_url = "AgACAgIAAxkBAANqaQjNVzo65QVYji0eCqjDtrFn13IAArQQaxu0CkBIp944CMFuLnMBAAMCAAN5AAM2BA"
                    webapp4_keyboard = InlineKeyboardMarkup(
                        inline_keyboard=[
                            [
                                InlineKeyboardButton(
                                    text="–ò–ª—å—è, —è —É—Å–ø–µ–≤–∞—é –∑–∞–±—Ä–∞—Ç—å ‚úÖ",
                                    web_app=WebAppInfo(url="https://illariooo.ru")
                                )
                            ]
                        ]
                    )
                    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
                    await bot.send_photo(chat_id=record.user_id, photo=photo4_url, caption=escape_md_v2(r"""
                    üñ§ *–û–Ω–∞ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç\. –ù–æ –ø—Ä–∏–Ω–æ—Å–∏—Ç –¥–µ–Ω—å–≥–∏ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å\)*

–ù–µ—Ç, —ç—Ç–æ –Ω–µ –º–∞—Ä–∫–µ—Ç–∏–Ω–≥.
–ò –Ω–µ —Ö–∞–π–ø.
 
–ï–µ –Ω–µ—Ç –≤ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ -
–Ω–æ –≤ —Ç–µ–ª–µ—Ñ–æ–Ω–∞—Ö —Ç—ã—Å—è—á –ª—é–¥–µ–π –æ–Ω–∞ –≤—ã–≥–ª—è–¥–∏—Ç –∞–±—Å–æ–ª—é—Ç–Ω–æ –∂–∏–≤–æ–π.
–õ–∏—Ü–æ, –º–∏–º–∏–∫–∞, —ç–º–æ—Ü–∏–∏, —Å—Ç–∏–ª—å - –≤—Å–µ –Ω–∞—Å—Ç–æ—è—â–µ–µ.
*–¢–æ–ª—å–∫–æ —Å–æ–∑–¥–∞–Ω–∞‚Ä¶  –º–Ω–æ–π* üòÖ

–≠—Ç–æ AI\-–º–æ–¥–µ–ª—å \- —Ü–∏—Ñ—Ä–æ–≤–∞—è –ª–∏—á–Ω–æ—Å—Ç—å, –∫–æ—Ç–æ—Ä–∞—è —Ä–∞–±–æ—Ç–∞–µ—Ç –≤–º–µ—Å—Ç–æ —Ç–µ–±—è.
–û–Ω–∞ –º–æ–∂–µ—Ç –≤–µ—Å—Ç–∏ –±–ª–æ–≥, –ø–æ–ª—É—á–∞—Ç—å –ª–∞–π–∫–∏, —Å–æ–±–∏—Ä–∞—Ç—å —Ñ–∞–Ω–∞—Ç–æ–≤ –∏‚Ä¶ –ø—Ä–∏–Ω–æ—Å–∏—Ç—å –¥–µ–Ω—å–≥–∏.

–ö–æ–≥–¥–∞ —è –≤–ø–µ—Ä–≤—ã–µ —É–≤–∏–¥–µ–ª, –∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —ç—Ç–∞ —Å–∏—Å—Ç–µ–º–∞ –±–∏–∑–Ω–µ—Å–∞ -

*–≤—Å–µ –ø–µ—Ä–µ–≤–µ—Ä–Ω—É–ª–æ—Å—å‚Ä¶*

\- –ù–µ –Ω—É–∂–Ω–æ –±–æ–ª—å—à–µ —Å–≤–µ—Ç–∏—Ç—å —Å–≤–æ–∏–º –ª–∏—Ü–æ–º –ø–µ—Ä–µ–¥ –∫–∞–º–µ—Ä–æ–π
\- –ù–µ –Ω—É–∂–Ω–æ –∑–∞–≤–∏—Å–µ—Ç—å –æ—Ç —Ä–µ–∫–ª–∞–º—ã –∏–ª–∏ —Ç—Ä–µ–Ω–¥–æ–≤
\- –¢—ã –ø—Ä–æ—Å—Ç–æ —Å–æ–∑–¥–∞–µ—à—å, –∞ —Å–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç

üé¨ –≠—Ç–æ –∫–∞–∫ –±—ã—Ç—å —Ä–µ–∂–∏—Å—Å–µ—Ä–æ–º —Ñ–∏–ª—å–º–∞.
–ì–¥–µ –∫–∞–∂–¥—ã–π –∫–∞–¥—Ä, –∫–∞–∂–¥–∞—è —ç–º–æ—Ü–∏—è –∏ –∫–∞–∂–¥—ã–π –¥–æ–ª–ª–∞—Ä - –ø–æ–¥ —Ç–≤–æ–∏–º –∫–æ–Ω—Ç—Ä–æ–ª–µ–º.

–Ø —Å–æ–±—Ä–∞–ª –≤—Å–µ, —á—Ç–æ —Ç–µ–±–µ –Ω—É–∂–Ω–æ –¥–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã –≤–æ—Ä–≤–∞—Ç—å—Å—è –≤ —ç—Ç–æ—Ç –Ω–æ–≤—ã–π —Ä—ã–Ω–æ–∫ - –≤ –ø—Ä–æ—Å—Ç–æ–º –∏ –ø–æ–Ω—è—Ç–Ω–æ–º —Ñ–∞–π–ª–µ. 

–£—Å–ø–µ–≤–∞–π –µ–≥–æ –∑–∞–±—Ä–∞—Ç—å, –ø–æ–∫–∞ —Å—Å—ã–ª–∫–∞ –µ—â–µ –¥–æ—Å—Ç—É–ø–Ω–∞ ‚è±Ô∏è
"""), parse_mode="MarkdownV2", reply_markup=webapp4_keyboard)  # pyright: ignore[reportUndefinedVariable,reportAttributeAccessIssue]

                    logger.info(f"–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ –ø–æ–∫—É–ø–∫–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é {record.user_id}.")

                    # –£–¥–∞–ª—è–µ–º –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—É—é –∑–∞–ø–∏—Å—å (–∏–ª–∏ –ø–æ–º–µ—á–∞–µ–º –∫–∞–∫ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—É—é)
                    await session.delete(record)

                except Exception as e:
                    logger.error(f"–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è 4 –¥–ª—è user_id={record.user_id}: {e}")
                    # –£–¥–∞–ª—è–µ–º –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—É—é –∑–∞–ø–∏—Å—å (–∏–ª–∏ –ø–æ–º–µ—á–∞–µ–º –∫–∞–∫ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—É—é)
                    await session.delete(record)
                    continue
            elif record.material_id == 5:
                webapp5_keyboard = InlineKeyboardMarkup(
                    inline_keyboard=[
                        [
                            InlineKeyboardButton(
                                text="AI-Model 2.0 üìÇ",
                                web_app=WebAppInfo(url="https://illariooo.ru")
                            )
                        ]
                    ]
                )
                try:
                    photo5_url = "AgACAgIAAxkBAAMcaQhqVpBQvJESXtK3oWgY3IwQU-gAAkgNaxu0CkBIY9-9o4RmZWcBAAMCAAN3AAM2BA"
                    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
                    await bot.send_photo(chat_id=record.user_id, photo=photo5_url, caption=escape_md_v2(r"""‚è≥ *–°—Ç—Ä–∞—à–Ω–æ –Ω–µ –ø–æ—Ç–µ—Ä—è—Ç—å –¥–µ–Ω—å–≥–∏, –∞ –≤—Ä–µ–º—è‚Ä¶*

–ü—Ä–æ—Å—Ç–æ –ø—Ä–µ–¥—Å—Ç–∞–≤—å:
\- –ø—Ä–æ—à–µ–ª –≥–æ–¥.

–¢—ã —Å–Ω–æ–≤–∞ —Å–∏–¥–∏—à—å –∑–∞ –Ω–æ—É—Ç–æ–º –∏ –∏—â–µ—à—å —Ö–æ—Ç—å —á—Ç–æ-—Ç–æ, —á—Ç–æ –ø—Ä–∏–Ω–µ—Å–µ—Ç —Ç–µ–±–µ –ø—Ä–∏–±—ã–ª—å.
–ê –≤ —ç—Ç–æ—Ç –º–æ–º–µ–Ω—Ç —Ä–µ–±—è—Ç–∞, –∫–æ—Ç–æ—Ä—ã–µ –∑–∞—à–ª–∏ –≤ AI-–º–æ–¥–µ–ª–∏ —Å–µ–≥–æ–¥–Ω—è,
*—É–∂–µ –≤–ø–µ—Ä–µ–¥–∏ —Ç–µ–±—è –Ω–∞ x10‚Ä¶*

–£ –Ω–∏—Ö - –¥–æ—Ö–æ–¥, –∫–æ—Ç–æ—Ä—ã–π —Ä–∞—Å—Ç–µ—Ç –∫–∞–∂–¥—ã–π –º–µ—Å—è—Ü.
–ê —Ç—ã –≤—Å–µ –µ—â–µ —Å–∫—Ä–æ–ª–ª–∏—à—å –ª–µ–Ω—Ç—É,
–î—É–º–∞—è, —á—Ç–æ —Ç—ã –Ω–µ —É—Å–ø–µ–ª.

–í–æ—Ç —á—Ç–æ –ø–æ-–Ω–∞—Å—Ç–æ—è—â–µ–º—É —Å—Ç—Ä–∞—à–Ω–æ -
–Ω–µ –ø—Ä–æ–≤–∞–ª, –∞ —à–∞–Ω—Å, –∫–æ—Ç–æ—Ä—ã–π —Ç—ã –ø–æ—Ç–µ—Ä—è–ª.

–ö–æ–≥–¥–∞ —è —Ç–æ–ª—å–∫–æ –Ω–∞—á–∏–Ω–∞–ª, —è —Ç–æ–∂–µ —Å–æ–º–Ω–µ–≤–∞–ª—Å—è.

–ù–æ –ø–æ—Ç–æ–º –ø–æ–Ω—è–ª:
\- –ù–µ –ø–æ–ø—Ä–æ–±—É—é, –æ—Å—Ç–∞–Ω—É—Å—å –Ω–∏ —Å —á–µ–º.

*–ü–µ—Ä–≤—ã–µ –≤—Å–µ–≥–¥–∞ –∑–∞–±–∏—Ä–∞—é—Ç —Å–∞–º–æ–µ —Å–ª–∞–¥–∫–æ–µ* üòã

AI\-–º–æ–¥–µ–ª–∏ \- —ç—Ç–æ –Ω–æ–≤–∞—è –Ω–∏—à–∞.
–ò –µ—Å–ª–∏ —Ç—ã –≤–æ—Ä–≤–µ—à—å—Å—è —Å–µ–π—á–∞—Å -
—á–µ—Ä–µ–∑ –≥–æ–¥ –ª—é–¥–∏ –±—É–¥—É—Ç —É—á–∏—Ç—å—Å—è —É —Ç–µ–±—è üí∞

–ó–∞–±–∏—Ä–∞–π –º–æ–π –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π —Ñ–∞–π–ª –∏ –ø–æ—Å–º–æ—Ç—Ä–∏, –∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–∏—Å—Ç–µ–º–∞, –∫–æ—Ç–æ—Ä–∞—è –ø—Ä–∏–Ω–æ—Å–∏—Ç –ø—Ä–∏–±—ã–ª—å –±–µ–∑ –∫–æ–º–∞–Ω–¥—ã, —Ä–µ–∫–ª–∞–º—ã –∏ —Ç–≤–æ–µ–≥–æ –ª–∏—Ü–∞ üëá
"""), parse_mode="MarkdownV2", reply_markup=webapp5_keyboard)  # pyright: ignore[reportUndefinedVariable,reportAttributeAccessIssue]

                    logger.info(f"–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ –ø–æ–∫—É–ø–∫–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é {record.user_id}.")

                    # –£–¥–∞–ª—è–µ–º –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—É—é –∑–∞–ø–∏—Å—å (–∏–ª–∏ –ø–æ–º–µ—á–∞–µ–º –∫–∞–∫ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—É—é)
                    await session.delete(record)

                except Exception as e:
                    logger.error(f"–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è 5 –¥–ª—è user_id={record.user_id}: {e}")
                    # –£–¥–∞–ª—è–µ–º –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—É—é –∑–∞–ø–∏—Å—å (–∏–ª–∏ –ø–æ–º–µ—á–∞–µ–º –∫–∞–∫ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—É—é)
                    await session.delete(record)
                    continue
            elif record.material_id == 6:
                photo6_url = "AgACAgIAAxkBAAMeaQhqcMYmRxe6hAnk92EbTqH0CcYAAkkNaxu0CkBIGsIs4Gxvd4kBAAMCAAN3AAM2BA"
                try:
                    webapp6_keyboard = InlineKeyboardMarkup(
                        inline_keyboard=[
                            [
                                InlineKeyboardButton(
                                    text="–Ø –ì–û–¢–û–í üî•",
                                    web_app=WebAppInfo(url="https://illariooo.ru")
                                )
                            ]
                        ]
                    )
                    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
                    await bot.send_photo(chat_id=record.user_id, photo=photo6_url, caption=escape_md_v2(r"""‚òÄÔ∏è *–£—Ç—Ä–æ‚Ä¶ –ö–æ—Ñ–µ‚Ä¶ –ù–æ—É—Ç‚Ä¶*

–ò –Ω–∏ –æ–¥–Ω–æ–≥–æ –¥–µ–¥–ª–∞–π–Ω–∞\)\)

–¢—ã –ø—Ä–æ—Å—ã–ø–∞–µ—à—å—Å—è –Ω–∞ —á–∏–ª–µ

–ù–µ—Ç —Å–ø–µ—à–∫–∏, –Ω–µ—Ç –∑–≤–æ–Ω–∫–æ–≤, –Ω–µ—Ç –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –æ—Ç –∫–æ–º–∞–Ω–¥—ã.
–í–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ - –æ–∫–Ω–æ, —Å–æ–ª–Ω—Ü–µ, –∏ —Ç–≤–æ—è AI –º–æ–¥–µ–ª—å,
–∫–æ—Ç–æ—Ä–∞—è —É–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∑–∞ —Ç–µ–±—è.

–û–Ω–∞ –≤–µ–¥–µ—Ç —Å–æ—Ü-—Å–µ—Ç–∏, —Å–æ–±–∏—Ä–∞–µ—Ç –ª–∞–π–∫–∏, –≤–µ–¥–µ—Ç –ø–µ—Ä–µ–ø–∏—Å–∫–∏,
*–ø—Ä–∏–Ω–æ—Å—è —Ç–µ–±–µ –¥–æ—Ö–æ–¥ - –¥–∞–∂–µ –ø–æ–∫–∞ —Ç—ã –∑–∞–≤—Ç—Ä–∞–∫–∞–µ—à—å.*

–≠—Ç–æ –Ω–µ —Å–∫–∞–∑–∫–∞. –≠—Ç–æ –Ω–æ–≤–∞—è —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å, –≤ –∫–æ—Ç–æ—Ä–æ–π —Ç—ã –æ–∫–∞–∑–∞–ª—Å—è üçÄ

–Ø —Ç–æ–∂–µ –¥—É–º–∞–ª, —á—Ç–æ —Ç–∞–∫ –Ω–µ –±—ã–≤–∞–µ—Ç.
–ê —Ç–µ–ø–µ—Ä—å –º–æ–π –æ–±—ã—á–Ω—ã–π –¥–µ–Ω—å - —ç—Ç–æ —Å–º–µ—Å—å –∏—Å–∫—É—Å—Å—Ç–≤–∞ –∏ –±–∏–∑–Ω–µ—Å–∞.

–¢—ã –Ω–µ —Å–∏–¥–∏—à—å –≤ –æ—Ñ–∏—Å–µ.
–¢—ã —Å–æ–∑–¥–∞–µ—à—å‚Ä¶ –∏ –ø–æ–ª—É—á–∞–µ—à—å.

ü™û –ñ–∏–∑–Ω—å –±–µ–∑ –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫–æ–≤ - —ç—Ç–æ –Ω–µ –ø—Ä–æ –ª–µ–Ω—å.
–û–Ω–∞ –ø—Ä–æ —Ç–æ, —á—Ç–æ–±—ã –∂–∏—Ç—å –≤ —Å–≤–æ–µ–º —Ä–∏—Ç–º–µ,
–≥–¥–µ —Ç—ã —Å–∞–º —Ä–µ—à–∞–µ—à—å, –∫–∞–∫ –ø—Ä–æ–π–¥–µ—Ç —Ç–≤–æ–π –¥–µ–Ω—å.

–£—Å—Ç–∞–ª —Å–∏–¥–µ—Ç—å –Ω–∏ —Å —á–µ–º? ü§î

*–ó–Ω–∞—á–∏—Ç –ø–æ—Ä–∞ –¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å!*

–ó–∞–±–∏—Ä–∞–π —Ñ–∞–π–ª, —á—Ç–æ–±—ã —É–∑–Ω–∞—Ç—å, –∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —ç—Ç–∞ —Å–∏—Å—Ç–µ–º–∞ –∏–∑–Ω—É—Ç—Ä–∏ üëá

"""), parse_mode="MarkdownV2", reply_markup=webapp6_keyboard)  # pyright: ignore[reportUndefinedVariable,reportAttributeAccessIssue]

                    logger.info(f"–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ –ø–æ–∫—É–ø–∫–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é {record.user_id}.")

                    # –£–¥–∞–ª—è–µ–º –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—É—é –∑–∞–ø–∏—Å—å (–∏–ª–∏ –ø–æ–º–µ—á–∞–µ–º –∫–∞–∫ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—É—é)
                    await session.delete(record)

                except Exception as e:
                    logger.error(f"–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è 6 –¥–ª—è user_id={record.user_id}: {e}")
                    # –£–¥–∞–ª—è–µ–º –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—É—é –∑–∞–ø–∏—Å—å (–∏–ª–∏ –ø–æ–º–µ—á–∞–µ–º –∫–∞–∫ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—É—é)
                    await session.delete(record)
                    continue
            elif record.material_id == 7:
                try:

                    # –ü–æ–ª—É—á–∞–µ–º –∏–º—è/username –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                    user_row = (await session.execute(
                        select(Clients).where(Clients.user_id == record.user_id)
                    )).scalars().first()
                    raw_name = None
                    if user_row:
                        raw_name = user_row.name or user_row.username or None
                    display_name = raw_name or "–¥—Ä—É–≥"
                    name_safe = escape_md_v2_strict(str(display_name))

                    header = f"*{name_safe}, –ø—Ä–∏–≤–µ—Ç* üòä\n"
                    body = escape_md_v2(r"""
–≠—Ç–æ —è –ª–∏—á–Ω–æ –ø–∏—à—É —Ç–µ–±–µ. 

–•–æ—Ç–µ–ª —É–∑–Ω–∞—Ç—å, –∫–∞–∫–∏–µ —Å–æ–º–Ω–µ–Ω–∏—è —É —Ç–µ–±—è –≤–æ–∑–Ω–∏–∫–ª–∏? 

–ü–æ—á–µ–º—É —Ç—ã, –Ω–∞ –ø—Ä–æ—Ç—è–∂–µ–Ω–∏–∏ 4 –¥–Ω–µ–π —Ç–∞–∫ –∏ –Ω–µ –æ—Ç–∫—Ä—ã–ª —Ñ–∞–π–ª?

–ï—Å–ª–∏ —É —Ç–µ–±—è –µ—Å—Ç—å –≤–æ–ø—Ä–æ—Å—ã \- –Ω–∞–ø–∏—à–∏ –º–Ω–µ, —è —Å—Ç–∞—Ä–∞—é—Å—å –æ—Ç–≤–µ—á–∞—Ç—å –≤—Å–µ–º\)

–ë—É–¥—É –±–ª–∞–≥–æ–¥–∞—Ä–µ–Ω ü§ù

–õ–∏–±–æ —Ç—ã –ø—Ä–æ—Å—Ç–æ –∑–∞–±—ã–ª –∏ —ç—Ç–æ –Ω–∞–ø–æ–º–∏–Ω–∞–ª–∫–∞ —Ç–µ–±–µ
""")
                    full_text = header + body

                    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
                    await bot.send_message(chat_id=record.user_id, text=full_text, parse_mode="MarkdownV2")  # pyright: ignore[reportUndefinedVariable,reportAttributeAccessIssue]

                    logger.info(f"–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ –ø–æ–∫—É–ø–∫–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é {record.user_id}.")

                    # –£–¥–∞–ª—è–µ–º –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—É—é –∑–∞–ø–∏—Å—å (–∏–ª–∏ –ø–æ–º–µ—á–∞–µ–º –∫–∞–∫ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—É—é)
                    await session.delete(record)

                except Exception as e:
                    logger.error(f"–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è 7 –¥–ª—è user_id={record.user_id}: {e}")
                    # –£–¥–∞–ª—è–µ–º –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—É—é –∑–∞–ø–∏—Å—å (–∏–ª–∏ –ø–æ–º–µ—á–∞–µ–º –∫–∞–∫ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—É—é)
                    await session.delete(record)
                    continue
            else:
                logger.warning(f"–ù–µ–æ–∂–∏–¥–∞–Ω–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è!")
                # –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –æ—Ç–ø—Ä–∞–≤–∫–∞–º–∏
            await asyncio.sleep(0.1)  # pyright: ignore[reportUndefinedVariable]
        await session.commit()

    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –≤ check_and_send_materials: {e}")
        await session.rollback()

@connection
async def set_time_table(session: AsyncSession, user_id: int):
    """–°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –≤ –±–¥ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –æ–ø—Ä–æ—Å–∞ –æ –¥–∑"""
    try:
        current_time = datetime.now()

        # –°–æ–∑–¥–∞–µ–º —Å–ø–∏—Å–æ–∫ –∑–∞–ø–∏—Å–µ–π –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è
        records = [
            SendTime(
                user_id=user_id,
                time_to_send=current_time + timedelta(minutes=30),
                material_id=1
            ),
            SendTime(
                user_id=user_id,
                time_to_send=current_time + timedelta(minutes=90),
                material_id=2
            ),
            SendTime(
                user_id=user_id,
                time_to_send=current_time + timedelta(hours=3),
                material_id=3
            ),
            SendTime(
                user_id=user_id,
                time_to_send=current_time + timedelta(hours=3),
                material_id=4
            ),
            SendTime(
                user_id=user_id,
                time_to_send=current_time + timedelta(hours=12),
                material_id=5
            ),
            SendTime(
                user_id=user_id,
                time_to_send=current_time + timedelta(hours=24),
                material_id=6
            ),
            SendTime(
                user_id=user_id,
                time_to_send=current_time + timedelta(hours=24),
                material_id=7
            ),
        ]

        # –î–æ–±–∞–≤–ª—è–µ–º –≤—Å–µ –∑–∞–ø–∏—Å–∏ –æ–¥–Ω–∏–º –≤—ã–∑–æ–≤–æ–º
        session.add_all(records)
        await session.commit()

        logger.info(f"–î–æ–±–∞–≤–ª–µ–Ω–∞ –∑–∞–¥–∞—á–∞ –Ω–∞ –ø–æ–ª—É—á–µ–Ω–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º {user_id}")

    except Exception as e:
        await session.rollback()
        logger.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–∏ —Ç–∞–±–ª–∏—Ü—ã —Ä–∞—Å—Å—ã–ª–æ–∫: {e}")
        raise
